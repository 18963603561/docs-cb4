<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="topic_gbk_tyh_t5">
  <title>Release Notes</title>
  <body>
    <p>Couchbase Server 4.6 delivers some exciting capabilities for cross datacenter replication,
      security, query, tools, and application development. Take a look at <xref
        href="../introduction/whats-new.dita">What's new</xref> for a list of new features and
      improvements that are available in this release.</p>
    <section id="release-4.6.5"><title>Release 4.6.5</title>
      <p>Couchbase Server 4.6.5 was released in June 2018. This is the fifth maintenance release in the 4.6.x series of Couchbase Server and includes important bug fixes applicable to all prior 4.x releases. We recommend that you upgrade to the 4.6.5 release at the earliest. <i>It is important to note that the upgrade should not be done via failover and delta node recovery.</i></p>
      <p><b>Fixed Issues</b></p>
      <p>This section lists some of the notable fixed issues in this release, grouped by component.</p>
      <p><b>Cross Datacenter Replication</b></p>
      <table frame="all" rowsep="1" colsep="1" id="table_xdcr-465">
        <tgroup cols="2">
          <colspec colname="c1" colnum="1" colwidth="0.25*"/>
          <colspec colname="c2" colnum="2" colwidth="0.75*"/>
          <thead>
            <row>
              <entry>Issue</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-29531" format="html"
                scope="external">MB-29531</xref></entry>
              <entry>Fixed an issue where bidirectional XDCR across clusters was not working as expected.</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
      
      <p><b>Data Service</b></p>
      <table frame="all" rowsep="1" colsep="1" id="table_data-465">
        <tgroup cols="2">
          <colspec colname="c1" colnum="1" colwidth="0.25*"/>
          <colspec colname="c2" colnum="2" colwidth="0.75*"/>
          <thead>
            <row>
              <entry>Issue</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-29959" format="html"
                  scope="external">MB-29959</xref></entry>
              <entry>During rebalance, it was observed that sometimes in-flight mutations did not
                persist correctly. Weâ€™ve fixed the issue in this release and recommend upgrading to
                get the fix. It is important to note that the upgrade should not be done via
                failover and delta node recovery.</entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-29381" format="html"
                scope="external">MB-29381</xref></entry>
              <entry>Rebalance failed initially if the destination node for a vBucket required a rollback.
                During a rebalance, if the destination node for a particular vBucket already had a previous, outdated version of that vBucket then the rebalance failed initially.</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
      
      <p><b>Tools</b></p>
      <table frame="all" rowsep="1" colsep="1" id="table_tools-465">
        <tgroup cols="2">
          <colspec colname="c1" colnum="1" colwidth="0.25*"/>
          <colspec colname="c2" colnum="2" colwidth="0.75*"/>
          <thead>
            <row>
              <entry>Issue</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-27880" format="html"
                scope="external">MB-27880</xref></entry>
              <entry>The <cmdname>cbbackupmgr</cmdname> utility failed to merge incremental backups. </entry>
            </row>
          </tbody>
        </tgroup>
      </table>
      </section>
    
    <section id="release-4.6.4"><title>Release 4.6.4</title>
      <p>Couchbase Server 4.6.4, released in November 2017, is the fourth maintenance release in the 4.6.x series of Couchbase Server. This release has fixes related data, index, and query services, security, tools, and upgrade.</p>
      <p><b>Fixed Issues</b></p>
      <p>This section lists some of the notable fixed issues in this release, grouped by component.</p>
      <p><b>Cluster Manager</b></p>
      <table frame="all" rowsep="1" colsep="1" id="table_clustermanager-464">
        <tgroup cols="2">
          <colspec colname="c1" colnum="1" colwidth="0.25*"/>
          <colspec colname="c2" colnum="2" colwidth="0.75*"/>
          <thead>
            <row>
              <entry>Issue</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
          <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-25682" format="html"
                scope="external">MB-25682</xref></entry>
            <entry>Cluster Manager (<codeph>beam.smp</codeph> process) experienced increased memory usage during the <codeph>/diag</codeph> collection during <codeph>cbcollect_info</codeph></entry>
            </row>
          </tbody>
        </tgroup>
      </table>
      <p><b>Data Service</b></p>
      <table frame="all" rowsep="1" colsep="1" id="table_dataservice-464">
        <tgroup cols="2">
          <colspec colname="c1" colnum="1" colwidth="0.25*"/>
          <colspec colname="c2" colnum="2" colwidth="0.75*"/>
          <thead>
            <row>
              <entry>Issue</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-25630" format="html"
                scope="external">MB-25630</xref></entry>
              <entry>The timing statistics did not report file system timings for read-write data
                stores. </entry>
            </row>
          </tbody>
        </tgroup>
      </table>
      
      <p><b>Index Service</b></p>
      <table frame="all" rowsep="1" colsep="1" id="table_indexservice-464">
        <tgroup cols="2">
          <colspec colname="c1" colnum="1" colwidth="0.25*"/>
          <colspec colname="c2" colnum="2" colwidth="0.75*"/>
          <thead>
            <row>
              <entry>Issue</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-26698" format="html"
                scope="external">MB-26698</xref></entry>
              <entry>The transport packet headers for incoming index service messages are now validated.</entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-26429" format="html"
                scope="external">MB-26429</xref></entry>
              <entry>For an index that was built with <codeph>defer_build:true</codeph>, the CREATE
                INDEX statement on the Indexes tab showed an invalid N1QL statement that could not
                be copied "as is" to run using <cmdname>cbq</cmdname> or the Query
                Workbench.</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
      
      <p><b>Query Service</b></p>
      <table frame="all" rowsep="1" colsep="1" id="table_queryservice-464">
        <tgroup cols="2">
          <colspec colname="c1" colnum="1" colwidth="0.25*"/>
          <colspec colname="c2" colnum="2" colwidth="0.75*"/>
          <thead>
            <row>
              <entry>Issue</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-26469" format="html"
                scope="external">MB-26469</xref></entry>
              <entry>The root certificate could not be verified when <cmdname>cbq-engine</cmdname> was manually brought up using <filepath>config/ssl-cert-key.pem</filepath> passed to both certfile and keyfile.</entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-26338" format="html"
                scope="external">MB-26338</xref></entry>
              <entry>Creating a PREPARE statement when another one with the same name but a different query was already present caused some PREPARE statements to hang. This issue was due to a lock not being released when a conflict was found. </entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-26012" format="html"
                scope="external">MB-26012</xref></entry>
              <entry>PREPARE statements were unable to decode <codeph>OrderedIntersectScan</codeph> as the operator was missing. This operator has been added.</entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-25901" format="html"
                scope="external">MB-25901</xref></entry>
              <entry>The ORDER BY operator sometimes continued to sort even after the operation was stopped leading to an exception.</entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-25900" format="html"
                scope="external">MB-25900</xref></entry>
              <entry>The ORDER BY operator sometimes threw an exception due to a race condition.</entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-25825" format="html"
                scope="external">MB-25825</xref></entry>
              <entry>Executing the encoded plan of a CREATE INDEX statement containing a WITH clause failed with an error.</entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-25737" format="html"
                scope="external">MB-25737</xref></entry>
              <entry>The aggregate function GROUP BY on an empty table incorrectly returned "null" instead of an empty array "[]".</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
      
      <p><b>Security</b></p>
      <table frame="all" rowsep="1" colsep="1" id="table_security-464">
        <tgroup cols="2">
          <colspec colname="c1" colnum="1" colwidth="0.25*"/>
          <colspec colname="c2" colnum="2" colwidth="0.75*"/>
          <thead>
            <row>
              <entry>Issue</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-25922" format="html"
                scope="external">MB-25922</xref></entry>
              <entry>On CentOS 6, the default Couchbase start priority was 50 and <cmdname>saslauthd</cmdname> had a default priority of 65. As a result, Couchbase started before <cmdname>saslauthd</cmdname> which caused authentication errors.</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
      
      <p><b>Tools</b></p>
      <table frame="all" rowsep="1" colsep="1" id="table_tools-464">
        <tgroup cols="2">
          <colspec colname="c1" colnum="1" colwidth="0.25*"/>
          <colspec colname="c2" colnum="2" colwidth="0.75*"/>
          <thead>
            <row>
              <entry>Issue</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-26498" format="html"
                scope="external">MB-26498</xref></entry>
              <entry>The check to see if two backup processes are running on the same archive was being performed after removing any unfinished merge files. As a result, if a backup process was started when another backup process was performing a merge, the merge files were deleted and the backup process failed.</entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-25770" format="html"
                scope="external">MB-25770</xref></entry>
              <entry>An error was thrown when trying to backup a cluster with a non-integer value for the metadata purge interval (for example 0.4).</entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-25727" format="html"
                scope="external">MB-25727</xref></entry>
              <entry>The <cmdname>cbbackupwrapper</cmdname> tool sent incorrect snap start, start, and snap end sequence numbers and was hanging during incremental backups.</entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-25679" format="html"
                scope="external">MB-25679</xref></entry>
              <entry>The default behavior of the <cmdname>cbcollect_info</cmdname> tool has been changed to just collecting diagnostics from the node it's run on.</entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-25566" format="html"
                scope="external">MB-25566</xref></entry>
              <entry>The <cmdname>cbbackupmgr</cmdname> tool failed with an error "<systemoutput>Argument already specified</systemoutput>" when an argument was set as an environment variable.</entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-26425" format="html"
                scope="external">MB-26425</xref></entry>
              <entry>The <cmdname>cbbackupmgr merge</cmdname> operation failed to return proper error messages when it failed to retrieve start sequence numbers from a backup.</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
      
      <p><b>Upgrade</b></p>
      <table frame="all" rowsep="1" colsep="1" id="table_upgrade-464">
        <tgroup cols="2">
          <colspec colname="c1" colnum="1" colwidth="0.25*"/>
          <colspec colname="c2" colnum="2" colwidth="0.75*"/>
          <thead>
            <row>
              <entry>Issue</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-25909" format="html"
                scope="external">MB-25909</xref>/<xref href="https://issues.couchbase.com/browse/MB-25878" format="html"
                scope="external">MB-25878</xref></entry>
              <entry>When the source node was upgraded in a unidirectional replication from 4.1 to 4.6, the GoGC global setting was set to 0 instead of a higher number.</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
      
    </section>
    <section id="release-4.6.3"><title>Release 4.6.3</title>
      <p>Couchbase Server 4.6.3, released in August 2017, is the third maintenance release in the
        4.6.x series of Couchbase Server. This release has fixes related to data, index, and query
        services, security, cluster manager, tools and UI.</p>
      <p><b>Fixed Issues</b></p>
      <p>This section lists some of the notable fixed issues in this release, grouped by component.</p>
      <p><b>Data Service</b></p>
      <table frame="all" rowsep="1" colsep="1" id="table_jjp_mmz_y1b">
        <tgroup cols="2">
          <colspec colname="c1" colnum="1" colwidth="0.25*"/>
          <colspec colname="c2" colnum="2" colwidth="0.75*"/>
          <thead>
            <row>
              <entry>Issue</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-25241" format="html"
                  scope="external">MB-25241</xref></entry>
              <entry>Requesting for the <parmname>topkeys</parmname> statistic without specifying a
                bucket resulted in a Memcached crash.</entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-24648" format="html"
                  scope="external">MB-24648</xref></entry>
              <entry>If a Data Service Couchbase Server node is added to a cluster using the same
                IP/host name of a node that has been a member of a cluster previously without first
                failing-over the old node, data loss can occur as the new node does not have the
                expected data. This has been fixed by first checking to see if the node is a part of
                the cluster before adding it.</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
      
      <p><b>Index Service</b></p>
      <table frame="all" rowsep="1" colsep="1" id="table_btk_qmz_y1b">
        <tgroup cols="2">
          <colspec colname="c1" colnum="1" colwidth="0.25*"/>
          <colspec colname="c2" colnum="2" colwidth="0.75*"/>
          <thead>
            <row>
              <entry>Issue</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-25318" format="html"
                  scope="external">MB-25318</xref></entry>
              <entry>When using Memory Optimized Indexes (MOI), the index service crashed when
                trying to open the database and load the snapshot following a restart.</entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-25266" format="html"
                  scope="external">MB-25266</xref></entry>
              <entry>Error checks during the creation or load of snapshots for Memory Optimized
                Indexes (MOI) have been added.</entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-25253" format="html"
                  scope="external">MB-25253</xref></entry>
              <entry>Index Service file descriptor leak in the index service has been fixed by
                ensuring that responses obtained from any HTTP request in GSI are closed.</entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-25146" format="html"
                  scope="external">MB-25146</xref></entry>
              <entry>Malformed requests were not handled by the Query Service and resulted in a
                crash on the Index Service.</entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-23583" format="html"
                  scope="external">MB-23583</xref></entry>
              <entry>Using Standard Disk Based indexes, the index service crashed repeatedly as
                compression or decompression failures during block reclaim were not propagated,
                resulting in corrupted data being used during the next block reuse or file
                re-open.</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
      
      <p><b>Query Service and N1QL</b></p>
      <table frame="all" rowsep="1" colsep="1" id="table_f2q_qmz_y1b">
        <tgroup cols="2">
          <colspec colname="c1" colnum="1" colwidth="0.25*"/>
          <colspec colname="c2" colnum="2" colwidth="0.75*"/>
          <thead>
            <row>
              <entry>Issue</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-25395" format="html"
                  scope="external">MB-25395</xref></entry>
              <entry>The query engine panicked when a prepared statement using subquery expressions
                was executed using the encoded plan.</entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-25388" format="html"
                  scope="external">MB-25388</xref></entry>
              <entry>With N1QL, the UNNEST using an array index was using a covering index
                incorrectly. For an UNNEST index to be covered it needs ALL not DISTINCT, even
                though the whole array present as part of the index.</entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-25290" format="html"
                  scope="external">MB-25290</xref></entry>
              <entry>Long integers were truncated when used in the <cmdname>ToString()</cmdname>
                function in N1QL.</entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-25167" format="html"
                  scope="external">MB-25167</xref></entry>
              <entry>Query Service authentication failed when the password contained a colon (":")
                character.</entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-24871" format="html"
                  scope="external">MB-24871</xref></entry>
              <entry>The execution of ad-hoc N1QL queries with parameters provided at the time of
                query submission has been optimized and no longer require a prepare-execute step..
                The parameters are substituted before optimization, thus ensuring the best possible
                index is selected. </entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-24594" format="html"
                  scope="external">MB-24594</xref></entry>
              <entry>N1QL with covered index joins returned incorrect results.</entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-21928" format="html"
                  scope="external">MB-21928</xref></entry>
              <entry>The command line shell for N1QL, cbq, now connects to 8091 with http and 18091
                with https by default when the port is not specified.</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
      
      <p><b>Cluster Manager</b></p>
      <table frame="all" rowsep="1" colsep="1" id="table_fnz_qmz_y1b">
        <tgroup cols="2">
          <colspec colname="c1" colnum="1" colwidth="0.25*"/>
          <colspec colname="c2" colnum="2" colwidth="0.75*"/>
          <thead>
            <row>
              <entry>Issue</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-24870" format="html"
                  scope="external">MB-24870</xref></entry>
              <entry>Logging for the views engine has been improved to lengthen the amount of data
                stored and reduce the wrapping of logs. </entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-24314" format="html"
                  scope="external">MB-24314</xref></entry>
              <entry>Removed assertion in Server Side Moxi to allow the service to continue to
                operate in the event that expected connections are not found in the internal
                tracking. Additionally added improved logging to diagnose such issues. </entry>
            </row>
          </tbody>
        </tgroup>
      </table>
      
      <p><b>Security</b></p>
      <table frame="all" rowsep="1" colsep="1" id="table_ewd_rmz_y1b">
        <tgroup cols="2">
          <colspec colname="c1" colnum="1" colwidth="0.25*"/>
          <colspec colname="c2" colnum="2" colwidth="0.75*"/>
          <thead>
            <row>
              <entry>Issue</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <!--<row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-25147" format="html"
                  scope="external">MB-25147</xref></entry>
              <entry/>
            </row>-->
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-24318" format="html"
                  scope="external">MB-24318</xref></entry>
              <entry>Improved error messages for TLS certificate validation.</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
      
      <p><b>Tools</b></p>
      <table frame="all" rowsep="1" colsep="1" id="table_ty3_rmz_y1b">
        <tgroup cols="2">
          <colspec colname="c1" colnum="1" colwidth="0.25*"/>
          <colspec colname="c2" colnum="2" colwidth="0.75*"/>
          <thead>
            <row>
              <entry>Issue</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-25464" format="html"
                  scope="external">MB-25464</xref></entry>
              <entry>When you run <cmdname>cbstats -a</cmdname>, if the statistics for one of the
                buckets in the list are unavailable, for example a Memcached bucket, the
                  <cmdname>cbstats</cmdname> utility exits without collecting the statistics from
                the remaining buckets in the list.</entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-25245" format="html"
                  scope="external">MB-25245</xref></entry>
              <entry>The <cmdname>cbrestorewrapper</cmdname> utility now has a
                  <codeph>--add</codeph> option that allows you to add so as to not overwrite
                existing items in the destination. </entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-25159" format="html"
                  scope="external">MB-25159</xref></entry>
              <entry>When the Couchbase cluster was overloaded and failed to respond to requests for
                the latest sequence numbers, or if a node in the cluster was unreachable when the
                backup started, the backup continued. However, this caused crashes or full
                re-streams in subsequent backups. </entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-24912" format="html"
                  scope="external">MB-24912</xref></entry>
              <entry>Two failover entries on the same server containing the same sequence number
                caused backups to not be incremental. This is a rare situation because Couchbase
                Server would need to be started and crash very quickly (before any items are written
                to it) in order for this issue to occur.</entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-24571" format="html"
                  scope="external">MB-24571</xref></entry>
              <entry>The <cmdname>cbbackupmgr</cmdname> utility now purges deletes during merge.
                Without purging, you would see an increase in your backup size during merges as
                deletes are always kept. </entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-24536" format="html"
                  scope="external">MB-24536</xref></entry>
              <entry>Transferring data using <cmdname>cbtransfer</cmdname> threw an exception and
                the <cmdname>cbtransfer</cmdname> utility hanged.</entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-21652" format="html"
                  scope="external">MB-21652</xref></entry>
              <entry>The error message "<systemoutput>db is being used by another
                  handle</systemoutput>" was not known to cause any issues and has been handled to
                not appear any more.</entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-20403" format="html"
                  scope="external">MB-20403</xref></entry>
              <entry>The <cmdname>cbbackupmgr merge</cmdname> command did not function correctly and
                caused data corruption under the following circumstances: <ul id="ul_qsg_f4q_1bb">
                  <li>The bucket being backed up was flushed between incremental backups.</li>
                  <li>The bucket being backed up was deleted and re-created in between incremental
                    backups.</li>
                  <li>The bucket had not been backed up between a document's deletion and the
                    metadata for that deleted document being purged.</li>
                  <li>There had been a failover between incremental backups of the bucket .</li>
                </ul></entry>
            </row>
          </tbody>
        </tgroup>
      </table>
      
      <p><b>UI - Web Console</b></p>
      <table frame="all" rowsep="1" colsep="1" id="table_z4q_rmz_y1b">
        <tgroup cols="2">
          <colspec colname="c1" colnum="1" colwidth="0.25*"/>
          <colspec colname="c2" colnum="2" colwidth="0.75*"/>
          <thead>
            <row>
              <entry>Issue</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-24197" format="html"
                  scope="external">MB-24197</xref></entry>
              <entry>When the Query Workbench failed to get the list of buckets, it resulted in a
                failure of all subsequent queries until the browser was refreshed and a valid list
                of buckets was received from the server. This has been fixed to report an error in
                the bucket analysis tab. Additionally, when the query engine starts working again,
                queries on non-password-protected buckets will work. However, if you want to query
                password-protected buckets, you need to either click the refresh button on the
                bucket analysis tab, or switch tabs away-from, and then back-to the query tab. </entry>
            </row>
          </tbody>
        </tgroup>
      </table>
      
      <p><b>XDCR</b></p>
      <table frame="all" rowsep="1" colsep="1" id="table_mfy_rmz_y1b">
        <tgroup cols="2">
          <colspec colname="c1" colnum="1" colwidth="0.25*"/>
          <colspec colname="c2" colnum="2" colwidth="0.75*"/>
          <thead>
            <row>
              <entry>Issue</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-25364" format="html"
                  scope="external">MB-25364</xref></entry>
              <entry>The default number of XDCR checkpoint records has been reduced from 100 to 5
                and the number of checkpoint records is now configurable at runtime using the
                parameter <parmname>num_checkpoints</parmname>. </entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-25013" format="html"
                  scope="external">MB-25013</xref></entry>
              <entry>When the host name in a remote cluster reference is unusable, XDCR picks an
                alternative target node in a more deterministic manner so that all source nodes
                would pick the same alternative target node.</entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-24832" format="html"
                  scope="external">MB-24832</xref></entry>
              <entry>XDCR incorrectly deletes replication streams. The replication periodically
                checks the source bucket status and if it detects a change in the source bucket
                UUID, which is caused by either bucket deletion or recreation, it deletes itself.
                However, replication incorrectly deleted itself when the source bucket check failed
                with an error that was not a change in the UUID. This has been fixed.</entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-24817" format="html"
                  scope="external">MB-24817</xref></entry>
              <entry>XDCR fails to replicate some documents during graceful failover of target
                cluster if the takeover stream was closed before all the items were streamed. </entry>
            </row>
            <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-24769" format="html"
                  scope="external">MB-24769</xref></entry>
              <entry>Computing sequence numbers in XDCR had an inefficiency when there were large
                gaps between sequence numbers and took much longer than needed to complete. This
                caused various issues such as stats missing from the log file and replication
                failing to stop for a while. </entry>
            </row>
          </tbody>
        </tgroup>
      </table>
      
      <p><b>Known Issues</b></p>
      <p>This section lists some of the known issues in this release.</p>
      <p>
        <table frame="all" rowsep="1" colsep="1" id="table_ebz_smz_y1b">
          <tgroup cols="2">
            <colspec colname="c1" colnum="1" colwidth="0.25*"/>
            <colspec colname="c2" colnum="2" colwidth="0.75*"/>
            <thead>
              <row>
                <entry>Issue</entry>
                <entry>Description</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-25590" format="html"
                    scope="external">MB-25590</xref></entry>
                <entry><b>Summary</b>: Query Service, Using N1QL incorrect results may be returned
                  when the UNNEST expression does not match the array index expression. For example:
                      <codeblock>CREATE INDEX idx-mismatch 
  ON default(all addr); 

EXPLAIN SELECT v.seqno 
FROM default 
  USE index (idx-mismatch) 
  UNNEST default.messages AS v 
WHERE v.seqno >1; </codeblock><p><b>Workaround</b>:
                    Do not use the simplified array index. Instead create a full array index as
                    shown in the following example:
                    <codeblock>CREATE INDEX idx-fullarray 
  ON default (ALL ARRAY v FOR v IN add END);</codeblock></p></entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-25669" format="html"
                    scope="external">MB-25669</xref></entry>
                <entry><b>Summary</b>: On Windows platform, the <cmdname>cbimport</cmdname> tool
                  fails to import a tab delimited CSV file where the tab is specified using
                    '<codeph>\t</codeph>' or '<codeph>\\t</codeph>'. <p><b>Workaround</b>: Use
                    Cygwin on the Windows platform to run the command as a Linux command. For
                    example,
                    <codeblock>$ /cygdrive/c/Program\ Files/Couchbase/Server/bin/cbimport.exe csv 
-c http://127.0.0.1:8091 
-u Administrator -p 'password' 
-b default 
-d file://c:/tmp/csv_tab 
--field-separator $'\t' </codeblock></p></entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-25188" format="html"
                    scope="external">MB-25188</xref></entry>
                <entry id="entry_nv4_bqq_1bb">Replication from a timestamp-based conflict resolution
                  bucket to Elasticsearch node is not supported and sequence number based conflict
                  resolution will be used instead. </entry>
              </row>
              <!--<row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-25004" format="html"
                    scope="external">MB-25004</xref></entry>
                <entry/>
              </row>-->
            </tbody>
          </tgroup>
        </table>
      </p>
      
    </section>
    
    <section id="release-4.6.2"><title>Release 4.6.2</title>
    <p>Couchbase Server 4.6.2, released in May 2017, is the second maintenance release in the 4.6.x
        series of Couchbase Server. This release has fixes related to many different components.</p><p><b>Fixed Issues</b></p><p dir="ltr">This section lists some of the notable fixed issues in this release,
          grouped by component:</p><p><b>Backup</b></p>
      <table id="table_egb_l1d_wz" frame="all" rowsep="1" colsep="1">
          <tgroup cols="2">
            <colspec colnum="1" colname="col1" colwidth=".25*"/>
            <colspec colnum="2" colname="col2" colwidth=".75*"/>
            <thead>
              <row>
                <entry dir="ltr">Issue</entry>
                <entry dir="ltr">Description</entry>
              </row>
            </thead>
            <tbody>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-23531"
                  format="html" scope="external">MB-23531</xref></entry>
              <entry dir="ltr">Sometimes <cmdname>cbbackupmgr</cmdname> would fail to get stats for
                a bucket when performing a backup. This results in some of the data from a bucket
                not being backed up.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-23105"
                  format="html" scope="external">MB-23105</xref></entry>
              <entry dir="ltr"><cmdname>cbbackupmgr</cmdname> might re-stream all mutations if there
                are multiple entries in a vBucket failover log. This causes
                  <cmdname>cbbackupmgr</cmdname> to run a full backup every time, rather than
                incremental backups.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22716"
                  format="html" scope="external">MB-22716</xref></entry>
              <entry dir="ltr">Using <cmdname>cbbackup</cmdname> with the command-line flag
                  <codeph>cbb_max_mx</codeph> causes <cmdname>cbbackup</cmdname> to unexpectedly
                terminate.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22325"
                  format="html" scope="external">MB-22325</xref></entry>
              <entry dir="ltr"><cmdname>cbbackupwrapper</cmdname> sometimes ends with a threading
                exception. Although this does not affect the backup, it would cause the incorrect
                exit code to be returned.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-20891"
                  format="html" scope="external">MB-20891</xref></entry>
              <entry dir="ltr">DCP rollbacks are sometimes not handled correctly, causing
                  <cmdname>cbbackupmgr</cmdname> to unexpectedly terminate for subsequent backups
                using the same archive. This unexpected termination would be indicated by the
                message 'panic: runtime error: invalid memory address or nil pointer
                dereference'.</entry>
            </row>
          </tbody>
          </tgroup>
        </table><p><b>Cluster Manager</b></p>
      <table id="table_fgb_l1d_wz" frame="all" rowsep="1" colsep="1">
          <tgroup cols="2">
            <colspec colnum="1" colname="col1" colwidth=".25*"/>
            <colspec colnum="2" colname="col2" colwidth=".75*"/>
            <thead>
              <row>
                <entry dir="ltr">Issue</entry>
                <entry dir="ltr">Description</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-24088"
                    format="html" scope="external">MB-24088</xref></entry>
                <entry dir="ltr">The secrets management feature fails to encrypt secrets larger than
                  4KB (such as SSL certificates). This causes the cluster manager to unexpectedly
                  terminate when saving the cluster configuration to disk. </entry>
              </row>
              <row>
                <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-23327"
                    format="html" scope="external">MB-23327</xref></entry>
                <entry dir="ltr">A race condition means that adding a node to a cluster shortly
                  after node startup causes the cluster management process on the node to crash.
                  This results in the failure of the node addition process.</entry>
              </row>
              <row>
                <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-23268"
                    format="html" scope="external">MB-23268</xref></entry>
                <entry dir="ltr">The cluster management process' logging does not recover from
                  situations where the disk that the logs are located on becomes full.</entry>
              </row>
            </tbody>
          </tgroup>
        </table><p><b>Data Service</b></p>
      <table id="table_ggb_l1d_wz" frame="all" rowsep="1" colsep="1">
          <tgroup cols="2">
            <colspec colnum="1" colname="col1" colwidth=".25*"/>
            <colspec colnum="2" colname="col2" colwidth=".75*"/>
            <thead>
              <row>
                <entry dir="ltr">Issue</entry>
                <entry dir="ltr">Description</entry>
              </row>
            </thead>
            <tbody>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-23591"
                  format="html" scope="external">MB-23591</xref></entry>
              <entry dir="ltr">A direct upgrade from 2.5.x to 4.6.x could result in a rebalance
                hanging or empty data files.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-23503"
                  format="html" scope="external">MB-23503</xref></entry>
              <entry dir="ltr">Previously removed items in replica vBuckets may be incorrectly
                restored during a failover. If a subsequent failover occurs then this could result
                in inconsistent/incorrect data.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-23269"
                  format="html" scope="external">MB-23269</xref></entry>
              <entry dir="ltr">The memcached process crashes when trying to write an audit event to
                a file with wrong permissions.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22814"
                  format="html" scope="external">MB-22814</xref></entry>
              <entry dir="ltr">When creating a new Memcached bucket, existing Couchbase buckets may
                appear as not ready in the Couchbase Web Console for a few seconds. This should not
                affect application clients.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22180"
                  format="html" scope="external">MB-22180</xref></entry>
              <entry dir="ltr">When a node is being rebalanced out of a cluster, its vBuckets are
                deleted. However, if there are pending disk fetches when the vBucket is deleted then
                they are not terminated correctly. This prevents the node from being accessible once
                it has been removed from a cluster.</entry>
            </row>
           <!-- Removing MB-22178 as per email from Nirvair, confirmed by Anil & Don as the fix has been moved to 4.6.3. This issue is added to the known issues list in 4.6.2. -->
              <!-- <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22178"
                  format="html" scope="external">MB-22178</xref></entry>
              <entry dir="ltr">VBuckets may be incorrectly identified as in a backfill state and
                never leave this state. This may result in a rebalance hanging as the rebalance
                waits for the vBucket to leave the backfill state.</entry>
            </row>-->
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22044"
                  format="html" scope="external">MB-22044</xref></entry>
              <entry dir="ltr">Sub-document mutations using the CAS for optimistic concurrency fail
                on an item that is already locked. </entry>
            </row>
          </tbody>
          </tgroup>
        </table><p><b>Indexing Service</b></p>
      <table id="table_hgb_l1d_wz" frame="all" rowsep="1" colsep="1">
          <tgroup cols="2">
            <colspec colnum="1" colname="col1" colwidth=".25*"/>
            <colspec colnum="2" colname="col2" colwidth=".75*"/>
            <thead>
              <row>
                <entry dir="ltr">Issue</entry>
                <entry dir="ltr">Description</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22693"
                    format="html" scope="external">MB-22693</xref></entry>
                <entry dir="ltr">The indexer does not remove the old value for a key if the new
                  value exceeds the maximum index length size.</entry>
              </row>
              <row>
                <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22692"
                    format="html" scope="external">MB-22692</xref></entry>
                <entry dir="ltr">Some corner cases in secondary key length checks cause the index to
                  have inconsistent or incorrect results. This only affects indexes where there are
                  keys which are close to the maximum key length.</entry>
              </row>
            </tbody>
          </tgroup>
        </table><p><b>Query Service</b></p>
      <table id="table_igb_l1d_wz" frame="all" rowsep="1" colsep="1">
          <tgroup cols="2">
            <colspec colnum="1" colname="col1" colwidth=".25*"/>
            <colspec colnum="2" colname="col2" colwidth=".75*"/>
            <thead>
              <row>
                <entry dir="ltr">Issue</entry>
                <entry dir="ltr">Description</entry>
              </row>
            </thead>
            <tbody>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-23203"
                  format="html" scope="external">MB-23203</xref></entry>
              <entry dir="ltr">The wrong index may be chosen when using
                <apiname>JOIN</apiname>.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22831"
                  format="html" scope="external">MB-22831</xref></entry>
              <entry dir="ltr">Inserting a numerical value using a N1QL query causes the value to be
                stored in scientific notation</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22630"
                  format="html" scope="external">MB-22630</xref></entry>
              <entry dir="ltr">Cipher AES128-SHA is incorrectly categorized as a medium-level
                cipher.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22578"
                  format="html" scope="external">MB-22578</xref></entry>
              <entry dir="ltr"><apiname>UNNEST</apiname> queries do not consider the
                  <apiname>WHEN</apiname> clause when selecting an index to use.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22577"
                  format="html" scope="external">MB-22577</xref></entry>
              <entry dir="ltr">Producing an array by ranging over objects does not work.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22536"
                  format="html" scope="external">MB-22536</xref></entry>
              <entry dir="ltr"><apiname>DATE_RANGE_STR()</apiname> and
                  <apiname>DATE_RANGE_MILLIS()</apiname> may give wrong results when using very
                large or very small values.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22530"
                  format="html" scope="external">MB-22530</xref></entry>
              <entry dir="ltr">The functions <apiname>ARRAY_RANGE()</apiname>,
                  <apiname>ARRAY_REPEAT()</apiname>, <apiname>DATE_RANGE_MILLIS()</apiname>,
                  <apiname>DATE_RANGE_STR()</apiname>, <apiname>REPEAT() </apiname>do not have
                bounds enforced. This causes the query engine to crash when very large arrays are
                generated.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22362"
                  format="html" scope="external">MB-22362</xref></entry>
              <entry dir="ltr">Using <apiname>LET</apiname> with <apiname>MISSING</apiname>
                incorrectly sets the value to <codeph>NULL</codeph>.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22273"
                  format="html" scope="external">MB-22273</xref></entry>
              <entry dir="ltr">In Couchbase clusters with multiple query service nodes, applications
                may get incorrect results from prepared N1QL queries that use covering
                indexes.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22119"
                  format="html" scope="external">MB-22119</xref></entry>
              <entry dir="ltr">In rare cases, the query engine may panic when evaluating
                  <apiname>ARRAY</apiname> expressions (for example <codeph>ARRAY x FOR x IN ...
                  END;</codeph>)</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-21284"
                  format="html" scope="external">MB-21284</xref></entry>
              <entry dir="ltr">Incorrect error message when non-JSON arguments are passed to the
                  <apiname>TOKENS()</apiname> function.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-20677"
                  format="html" scope="external">MB-20677</xref></entry>
              <entry dir="ltr"><apiname>REGEXP_LIKE() </apiname>does not return an error when an
                invalid pattern string is passed.</entry>
            </row>
          </tbody>
          </tgroup>
        </table>
    <p><b>Web Console</b></p>
      <table id="table_jgb_l1d_wz" frame="all" rowsep="1" colsep="1">
          <tgroup cols="2">
            <colspec colnum="1" colname="col1" colwidth=".25*"/>
            <colspec colnum="2" colname="col2" colwidth=".75*"/>
            <thead>
              <row>
                <entry dir="ltr">Issue</entry>
                <entry dir="ltr">Description</entry>
              </row>
            </thead>
            <tbody>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-23541"
                  format="html" scope="external">MB-23541</xref></entry>
              <entry dir="ltr">When the web console has been disabled over port 8091, in certain
                circumstances a login page will still be shown.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-23308"
                  format="html" scope="external">MB-23308</xref></entry>
              <entry dir="ltr">Using the REST API and web console over SSL (port 18091) does not
                work correctly in recent versions of Google Chrome (56.0 onwards) and Mozilla
                Firefox (51.0 onwards).</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-23244"
                  format="html" scope="external">MB-23244</xref></entry>
              <entry dir="ltr">If a bucket password contains semicolon, the web console will
                truncate the password to the semicolon when saving the bucket setting.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-20741"
                  format="html" scope="external">MB-20741</xref></entry>
              <entry dir="ltr">The web console login page has character limit of 24 characters for
                the password, but this limit is not enforced in other components.</entry>
            </row>
          </tbody>
          </tgroup>
        </table>
      <p dir="ltr"><b>XDCR</b></p><table id="table_kgb_l1d_wz" frame="all" rowsep="1" colsep="1">
          <tgroup cols="2">
            <colspec colnum="1" colname="col1" colwidth=".25*"/>
            <colspec colnum="2" colname="col2" colwidth=".75*"/>
            <thead>
              <row>
                <entry dir="ltr">Issue</entry>
                <entry dir="ltr">Description</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-23228"
                    format="html" scope="external">MB-23228</xref></entry>
                <entry dir="ltr">Replication frequently restarts when a node is removed from target
                  cluster.</entry>
              </row>
              <row>
                <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22997"
                    format="html" scope="external">MB-22997</xref></entry>
                <entry dir="ltr">XDCR sometimes has a backlog of items in its DCP queue due to a
                  deadlock. This causes increased memory usage and issues with replication
                  progress.</entry>
              </row>
              <row>
                <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22754"
                    format="html" scope="external">MB-22754</xref></entry>
                <entry dir="ltr">XDCR may not be able to detect if a bucket is deleted and then
                  recreated on a target cluster.</entry>
              </row>
              <row>
                <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22678"
                    format="html" scope="external">MB-22678</xref></entry>
                <entry dir="ltr">XDCR is not able to connect to an elasticsearch target due to an
                  incorrect endpoint.</entry>
              </row>
              <row>
                <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22382"
                    format="html" scope="external">MB-22382</xref></entry>
                <entry dir="ltr">In some cases, the thread handling a DCP stream may exit before
                  closing its stream. This results in the XDCR process unexpectedly
                  terminating.</entry>
              </row>
              <row>
                <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22224"
                    format="html" scope="external">MB-22224</xref></entry>
                <entry dir="ltr">XDCR does not set the snapshot start sequence number and vBucket
                  uuid correctly when starting a DCP stream request. This results in the whole
                  vBucket being re-streamed when replication is restarted, rather than from the most
                  recent checkpoint.</entry>
              </row>
            </tbody>
          </tgroup>
        </table>
    <p><b>Improvements</b></p><p dir="ltr">This section lists some of the notable improvements in this
          release, grouped by component:</p><p><b>Cluster Manager</b></p>
      <table id="table_lgb_l1d_wz" frame="all" rowsep="1" colsep="1">
          <tgroup cols="2">
            <colspec colnum="1" colname="col1" colwidth=".25*"/>
            <colspec colnum="2" colname="col2" colwidth=".75*"/>
            <thead>
              <row>
                <entry dir="ltr">Issue</entry>
                <entry dir="ltr">Description</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22252"
                    format="html" scope="external">MB-22252</xref></entry>
                <entry dir="ltr">Change the default behavior of the cluster manager to wait for the
                master password by default. This new behavior is detailed in <xref
                  href="../security/secret-mgmt.dita#topic_s2r_2yt_gy"/>.</entry>
              </row>
            </tbody>
          </tgroup>
    </table><p><b>Query</b></p><table id="table_mgb_l1d_wz" frame="all" rowsep="1" colsep="1">
          <tgroup cols="2">
            <colspec colnum="1" colname="col1" colwidth=".25*"/>
            <colspec colnum="2" colname="col2" colwidth=".75*"/>
            <thead>
              <row>
                <entry dir="ltr">Issue</entry>
                <entry dir="ltr">Description</entry>
              </row>
            </thead>
            
            <tbody>
            
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22750"
                  format="html" scope="external">MB-22750</xref></entry>
              <entry dir="ltr">Add <apiname>CONTAINS_TOKEN_LIKE()</apiname> and
                  <apiname>CONTAINS_TOKEN_REGEXP()</apiname>.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22646"
                  format="html" scope="external">MB-22646</xref></entry>
              <entry dir="ltr">Allow arbitrary variable names in array index selection.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22645"
                  format="html" scope="external">MB-22645</xref></entry>
              <entry dir="ltr">Support simpler syntax for array indexing when all array elements are
                indexed.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22644"
                  format="html" scope="external">MB-22644</xref></entry>
              <entry dir="ltr">Enable the string function <apiname>CONTAINS()</apiname> to use the
                functional index created with <apiname>SUFFIXES()</apiname>.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22629"
                  format="html" scope="external">MB-22629</xref></entry>
              <entry dir="ltr">Performance improvement for
                <apiname>CONTAINS_TOKEN()</apiname>.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22606"
                  format="html" scope="external">MB-22606</xref></entry>
              <entry dir="ltr">Enable <apiname>DATE_RANGE_STR()</apiname> to accept different
                supported date formats as parameters.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22550"
                  format="html" scope="external">MB-22550</xref></entry>
              <entry dir="ltr">Add <apiname>OBJECT_RENAME()</apiname> and
                  <apiname>OBJECT_REPLACE()</apiname> functions.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22470"
                  format="html" scope="external">MB-22470</xref></entry>
              <entry dir="ltr">Improve pattern matching speed with <apiname>LIKE</apiname> and
                  <apiname>HAS_TOKEN()</apiname>.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22417"
                  format="html" scope="external">MB-22417</xref></entry>
              <entry dir="ltr">Add weekday part to N1QL datetime functions.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22332"
                  format="html" scope="external">MB-22332</xref></entry>
              <entry dir="ltr">Push down <apiname>ORDER</apiname>, <apiname>COUNT()</apiname>,
                  <apiname>MIN()</apiname> to covering <apiname>UNNEST</apiname> index.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22321"
                  format="html" scope="external">MB-22321</xref></entry>
              <entry dir="ltr">Add <apiname>OrderedIntersectScan</apiname> for pagination.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22315"
                  format="html" scope="external">MB-22315</xref></entry>
              <entry dir="ltr">Push down <apiname>LIMIT</apiname> to
                  <apiname>IntersectScan</apiname> and <apiname>UnionScan</apiname>.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22309"
                  format="html" scope="external">MB-22309</xref></entry>
              <entry dir="ltr">Push down <apiname>LIMIT</apiname> to
                <apiname>DistinctScan</apiname>.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22285"
                  format="html" scope="external">MB-22285</xref></entry>
              <entry dir="ltr">Infer <apiname>IS NOT MISSING</apiname> term for <apiname>INNER
                  UNNEST</apiname> expressions on primary keyspace</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22148"
                  format="html" scope="external">MB-22148</xref></entry>
              <entry dir="ltr">Variable length sarging for <apiname>OR</apiname> predicates.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22143"
                  format="html" scope="external">MB-22143</xref></entry>
              <entry dir="ltr">Index scans for <apiname>OR</apiname> predicates on disjoint
                terms.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22124"
                  format="html" scope="external">MB-22124</xref></entry>
              <entry dir="ltr">Allow <apiname>NOT IN</apiname>/<apiname>WITHIN</apiname> queries to
                use secondary indexes.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-21770"
                  format="html" scope="external">MB-21770</xref></entry>
              <entry dir="ltr">Relax the mandatory array index-key, to create covering
                array-index.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-20626"
                  format="html" scope="external">MB-20626</xref></entry>
              <entry dir="ltr">Avoiding full index scan and optimize processing of queries with
                whole <apiname>IN</apiname> clause as a query parameter.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-19916"
                  format="html" scope="external">MB-19916</xref></entry>
              <entry dir="ltr">Add support for N1QL expressions in <apiname>SELECT</apiname>
                from-clause, and subqueries over nested collections.</entry>
            </row>
            <row>
              <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-19078"
                  format="html" scope="external">MB-19078</xref></entry>
              <entry dir="ltr">Add quiet mode option to <cmdname>cbq</cmdname> to not echo the
                content of input file.</entry>
            </row>
          </tbody>
          </tgroup>
        </table><p><b>XDCR</b></p>
      <table id="table_ngb_l1d_wz" frame="all" rowsep="1" colsep="1">
          <tgroup cols="2">
            <colspec colnum="1" colname="col1" colwidth="0.25*"/>
            <colspec colnum="2" colname="col2" colwidth="0.75*"/>
              <thead><row>
                <entry dir="ltr">Issue</entry>
                <entry dir="ltr">Description</entry>
              </row></thead>
            <tbody>
              <row>
                <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-23305"
                    format="html" scope="external">MB-23305</xref></entry>
                <entry dir="ltr">Make capi nozzle runtime parameters externally
                configurable.</entry>
              </row>
              <row>
                <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22832"
                    format="html" scope="external">MB-22832</xref></entry>
                <entry dir="ltr">Do not refresh metadata about a target cluster reference in every
                  replication. This reduces the number of requests to a target cluster in situations
                  where there are multiple buckets being replicated from the source.</entry>
              </row>
              <row>
                <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22514"
                    format="html" scope="external">MB-22514</xref></entry>
                <entry dir="ltr">Reduce the number of outgoing connections to the target
                  cluster.</entry>
              </row>
            </tbody>
          </tgroup>
    </table><p><b>Known Issues</b></p><p dir="ltr">This section lists some of the known issues in this
          release:</p>
      <table id="table_ogb_l1d_wz" frame="all" rowsep="1" colsep="1">
          <tgroup cols="2">
            <colspec colnum="1" colname="col1" colwidth="0.25*"/>
            <colspec colnum="2" colname="col2" colwidth="0.75*"/>
            <thead>
              <row>
                <entry dir="ltr">Issue </entry>
                <entry dir="ltr">Description </entry>
              </row>
              </thead>
              <tbody>
                <row>
              <entry><xref href="https://issues.couchbase.com/browse/MB-24066" format="html"
                  scope="external">MB-24066</xref></entry>
              <entry>When upgrading from Couchbase Server 2.5.x to Couchbase Server 4.6.2 directly
                on a Couchbase Server cluster using views, rebalances may hang.<p>Workaround:
                  Upgrade the cluster fully to Couchbase Server 3.1.6 as an intermediate step,
                  before upgrading the cluster to Couchbase Server 4.6.2.</p></entry>
            </row>
                <row>
                  <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-22178"
                    format="html" scope="external">MB-22178</xref></entry>
                  <entry dir="ltr">VBuckets may be incorrectly identified as in a backfill state and
                    never leave this state. This may result in a rebalance hanging as the rebalance
                    waits for the vBucket to leave the backfill state.</entry>
                </row>
              <row>
                <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-20403"
                    format="html" scope="external">MB-20403</xref></entry>
                <entry>
                  <p dir="ltr">The cbbackupmgr merge command will not function correctly and may
                    cause data corruption under the following circumstances:</p>
                  <ul id="ul_pgb_l1d_wz">
                    <li dir="ltr">
                      <p dir="ltr">The bucket being backed up is <xref
                          href="https://developer.couchbase.com/documentation/server/4.6/clustersetup/bucket-flush.html#topic_v1t_trm_gv"
                          format="html" scope="external">flushed</xref> between incremental
                        backups</p>
                    </li>
                    <li dir="ltr">
                      <p dir="ltr">The bucket being backed up is deleted and re-created in between
                        incremental backups</p>
                    </li>
                    <li dir="ltr">
                      <p dir="ltr">The bucket has not been backed up between a document's deletion
                        and the <xref
                          href="https://developer.couchbase.com/documentation/server/4.6/architecture/core-data-access-bucket-disk-storage.html#concept_cy4_tr2_xs__tombstone"
                          format="html" scope="external">metadata for that deleted document being
                          purged</xref></p>
                    </li>
                    <li dir="ltr">
                      <p dir="ltr">There has been a failover between incremental backups of the
                        bucket</p>
                    </li>
                  </ul>
                  <p dir="ltr">For more information about the Merge functionality, see <xref
                      href="https://developer.couchbase.com/documentation/server/4.6/backup-restore/cbbackupmgr-merge.html#cbbackupmgr-merge.1"
                      format="html" scope="external">cbbackupmgr merge</xref>.</p>
                  <p dir="ltr">Workaround: In the interim, the recommendation is to perform a full
                  backup if you experience any of the above scenarios. This will lead to longer
                  backup times than performing incremental backups, but will avoid potential data
                  corruption due to the aforementioned issue.</p>
                </entry>
              </row>
              <row>
                <entry dir="ltr"><xref href="https://issues.couchbase.com/browse/MB-20338"
                    format="html" scope="external">MB-20338</xref></entry>
                <entry dir="ltr">When any topology changes occur on source cluster, such as when a
                  node is removed, in some cases the outbound XDCR mutation statistics show a
                  negative number on the monitoring page. </entry>
              </row>
            </tbody>
          </tgroup>
        </table>
    </section>
    <section id="release-4.6.1"><title>Release 4.6.1</title>
      <p>Couchbase Server 4.6.1, released in March 2017, is the first maintenance release in the
        4.6.x series for Couchbase Server. This release has fixes related to N1QL query, XDCR,
        indexing, and backup.</p>
      <p><b>Fixed Issues</b></p>
      <p>This section lists some of the fixed issues in this release:</p>
      <p>
        <table frame="all" rowsep="1" colsep="1" id="fixediissues">
          <tgroup cols="2">
            <colspec colname="c1" colnum="1" colwidth="1*"/>
            <colspec colname="c2" colnum="2" colwidth="2.64*"/>
            <thead>
              <row>
                <entry>Issue</entry>
                <entry>Description</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-23114" format="html"
                    scope="external">MB-23114</xref></entry>
                <entry>Under certain circumstances the <codeph>cbbackupmgr merge</codeph> command
                  may not properly display an error on the command line when merge fails. </entry>
              </row>
              <row>
                <entry>
                  <xref href="https://issues.couchbase.com/browse/MB-23112" format="html"
                    scope="external">MB-23112</xref></entry>
                <entry>When using XDCR from a cluster running Couchbase Server 4.x (prior to 4.6.0)
                  to a 4.6.0 cluster, XDCR stops when it tries to replicate
                    <codeph>tombstones</codeph> (deletes) and fails with an error message
                  EINVAL.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-23032" format="html"
                    scope="external">MB-23032</xref></entry>
                <entry>When the query engine receives many syntactically incorrect N1QL statements,
                  the Query Service processes may leak memory resulting in query engine crash with
                  multiple <codeph>goroutine</codeph> stacktraces, or unexpected or unresponsive
                  behavior.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-22409" format="html"
                    scope="external">MB-22409</xref></entry>
                <entry>The Indexer Service crashes while indexing an array whose size is close to
                  the maximum index array size.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-22389" format="html"
                    scope="external">MB-22389</xref></entry>
                <entry>The Indexer Service crashes when there is a buffer overrun in secondary key
                  length check.</entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </p>
      <p><b>Known Issues</b></p>
      <p>This section lists some of the known issues in this release:</p>
      <p>
        <table frame="all" rowsep="1" colsep="1" id="table_ld4_5bn_2z">
          <tgroup cols="2">
            <colspec colname="c1" colnum="1" colwidth="1*"/>
            <colspec colname="c2" colnum="2" colwidth="2.64*"/>
            <thead>
              <row>
                <entry>Issue</entry>
                <entry>Description</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-22814" format="html"
                    scope="external">MB-22814</xref></entry>
                <entry>When creating a new Memcached bucket, existing Couchbase buckets may appear
                  as not ready in the Couchbase Web Console for a few seconds. This should not
                  affect the application clients.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-22273" format="html"
                    scope="external">MB-22273</xref></entry>
                <entry>
                  <p>In Couchbase clusters with multiple query service nodes, applications may get
                    incorrect results from prepared N1QL queries that use covering indexes.</p>
                  <p><b>Workaround:</b> The following two options can be used to avoid this
                    problem:</p>
                  <ul>
                    <li>Do not use prepared statements.</li>
                    <li>If using the Java SDK, set the undocumented property
                        <systemoutput>N1qlQueryExecutor.ENCODED_PLAN_ENABLED_PROPERTY</systemoutput>
                      to "<systemoutput>false</systemoutput>" before opening the bucket. For
                      example,</li>
                  </ul>
                  <p><systemoutput>System.setProperty(N1qlQueryExecutor.ENCODED_PLAN_ENABLED_PROPERTY,
                      "false") .. cluster.openBucket(bucketname)</systemoutput></p>
                </entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-20403" format="html"
                    scope="external">MB-20403</xref></entry>
                <entry>
                  <p>The <codeph>cbbackupmgr merge</codeph> command will not function correctly and
                    may cause data corruption under the following circumstances:</p>
                  <ul>
                    <li>The bucket being backed up is <xref
                        href="../clustersetup/bucket-flush.dita#topic_v1t_trm_gv">flushed</xref>
                      between incremental backups</li>
                    <li> The bucket being backed up is deleted and re-created in between incremental
                      backups </li>
                    <li> The bucket has not been backed up between a document's deletion and the
                        <xref
                        href="../architecture/core-data-access-bucket-disk-storage.dita#concept_cy4_tr2_xs/tombstone"
                        >metadata for that deleted document being purged</xref>
                    </li>
                    <li>There has been a failover between incremental backups of the bucket</li>
                  </ul>
                  <p>For more information about the Merge functionality, see <xref
                      href="../backup-restore/cbbackupmgr-merge.dita#cbbackupmgr-merge.1"/>.</p>
                  <p><b>Workaround</b>: In the interim, the recommendation is to perform a full
                    backup if you experience any of the above scenarios. This will lead to longer
                    backup times than performing incremental backups, but will avoid potential data
                    corruption due to to the aforementioned issue.</p>
                </entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-20338" format="html"
                    scope="external">MB-20338</xref></entry>
                <entry>When any topology changes occur on source cluster such as â€˜when a node is
                  removedâ€™, in some edge cases the outbound XDCR mutation statistics show a negative
                  number on the Monitoring page.</entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </p>
    </section>
    <section id="release-4.6.0"><title>Release 4.6.0</title>
      <p>Couchbase Server 4.6.0 was released in February 2017.</p>
      <p><b>Supported Platforms</b></p>
      <p>This release also adds support for Microsoft Windows 10 Anniversary Edition and Mac OS
        Sierra. For more information, see <xref href="../install/install-platforms.dita#topic1634"
        />.</p>
      <p><b>Changes in Behavior</b></p>
      <p>Here are the behavior changes in the product, compared to the previous release: <ul
          id="ul_zs4_whs_dz">
          <li>Results for the <codeph>OBJECT_PAIRS</codeph> and <codeph>OBJECT_INNER_PAIRS</codeph>
              functions:<p dir="ltr">Starting from version 4.6.0, the results generated by
                <codeph>OBJECT_PAIRS</codeph> and <codeph>OBJECT_INNER_PAIRS</codeph> functions use
              the word "val" for value instead of the N1QL reserved word "value". </p><p dir="ltr"
              >For example:
            </p><codeblock>"results": [ 
      { "$1": [ { "name": "key1", "<b>val</b>": "val1" } ] 
       }
  ] </codeblock></li>
          <li>CREATE INDEX is not allowed using any of the document metadata attributes except
              <codeph>meta().id</codeph>: <p>In earlier releases, CREATE INDEX on metadata such as
                <codeph>meta().cas</codeph>, <codeph>meta().flags</codeph>,
                <codeph>meta().expiry</codeph> etc. were allowed, but respective metadata attributes
              werenâ€™t getting indexed. Couchbase Server 4.6 allows only <codeph>meta().id</codeph>
              attribute in index-key expressions when creating secondary index.</p></li>
          <li>META function:<p><codeph>META()</codeph> with no keyspace parameter can be used in
              N1QL statements when that query/statement refers to only one keyspace or bucket. When
              multiple keyspaces are referred in a query (for example, JOIN or NEST), then the META
              expressions must be used with specific keyspace names as parameter, such as
                <codeph>META(keyspace)</codeph>. In earlier releases, this requirement is not
              enforced, and <codeph>META()</codeph> with no parameters is still accepted, implicitly
              referring to the first keyspace name used in the query. Couchbase 4.6 enforces this
              requirement and throws syntax error if <codeph>META()</codeph> is used with no
              parameter.</p></li>
          <li>Upgrading Couchbase Server when Full Text Search (FTS) Service is enabled: <p>When
              upgrading a cluster with nodes running FTS, upgrades will fail unless all full text
              index definitions are first deleted. To upgrade a cluster with FTS indexes, first save
              the existing index definition JSON, then remove all full text indexes. Then upgrade
              all nodes to the desired version. Once all nodes are upgraded, recreate the index
              definitions using the REST API. Note that you need to manually remove the
                <codeph>byte_array_converter</codeph> attribute from the index definition JSON (see
                <xref href="https://issues.couchbase.com/browse/MB-18042" format="html"
                scope="external">MB-18042</xref>).</p></li>
        </ul></p>
      <p><b>Known Issues</b></p>
      <p>This section lists some of the known issues in this release:</p>
      <p>
        <table frame="all" rowsep="1" colsep="1" id="known-issues">
          <tgroup cols="2">
            <colspec colname="c1" colnum="1" colwidth="1*"/>
            <colspec colname="c2" colnum="2" colwidth="2.64*"/>
            <thead>
              <row>
                <entry>Issue</entry>
                <entry>Description</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>
                  <xref href="https://issues.couchbase.com/browse/MB-23112" format="html"
                    scope="external">MB-23112</xref></entry>
                <entry>When using XDCR from a cluster running Couchbase Server 4.x (prior to 4.6.0)
                  to a 4.6.0 cluster, XDCR stops when it tries to replicate
                    <codeph>tombstones</codeph> (deletes) and fails with an error message EINVAL.<p>
                    <note class="- topic/note " type="important">We recommend you wait for the
                      upcoming bug-fix version 4.6.1 to upgrade. </note>
                  </p></entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-22814" format="html"
                    scope="external">MB-22814</xref></entry>
                <entry>When creating a new Memcached bucket, existing Couchbase buckets may appear
                  as not ready in the Couchbase Web Console for a few seconds. This should not
                  affect the application clients.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-22273" format="html"
                    scope="external">MB-22273</xref></entry>
                <entry>
                  <p>In Couchbase clusters with multiple query service nodes, applications may get
                    incorrect results from prepared N1QL queries that use covering indexes.</p>
                  <p><b>Workaround:</b> The following two options can be used to avoid this
                    problem:</p>
                  <ul id="ul_y2t_zqy_dz">
                    <li>Do not use prepared statements.</li>
                    <li>If using the Java SDK, set the undocumented property
                        <systemoutput>N1qlQueryExecutor.ENCODED_PLAN_ENABLED_PROPERTY</systemoutput>
                      to "<systemoutput>false</systemoutput>" before opening the bucket. For
                      example,</li>
                  </ul>
                  <p><systemoutput>System.setProperty(N1qlQueryExecutor.ENCODED_PLAN_ENABLED_PROPERTY,
                      "false") .. cluster.openBucket(bucketname)</systemoutput></p>
                </entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-20403" format="html"
                    scope="external">MB-20403</xref></entry>
                <entry>
                  <p>The <codeph>cbbackupmgr merge</codeph> command will not function correctly and
                    may cause data corruption under the following circumstances:</p>
                  <ul>
                    <li>The bucket being backed up is <xref
                        href="../clustersetup/bucket-flush.dita#topic_v1t_trm_gv">flushed</xref>
                      between incremental backups</li>
                    <li> The bucket being backed up is deleted and re-created in between incremental
                      backups </li>
                    <li> The bucket has not been backed up between a document's deletion and the
                        <xref
                        href="../architecture/core-data-access-bucket-disk-storage.dita#concept_cy4_tr2_xs/tombstone"
                        >metadata for that deleted document being purged</xref>
                    </li>
                    <li>There has been a failover between incremental backups of the bucket</li>
                  </ul>
                  <p>For more information about the Merge functionality, see <xref
                      href="../backup-restore/cbbackupmgr-merge.dita#cbbackupmgr-merge.1"/>.</p>
                  <p><b>Workaround</b>: In the interim, the recommendation is to perform a full
                    backup if you experience any of the above scenarios. This will lead to longer
                    backup times than performing incremental backups, but will avoid potential data
                    corruption due to to the aforementioned issue.</p>
                </entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-20338" format="html"
                    scope="external">MB-20338</xref></entry>
                <entry>When any topology changes occur on source cluster such as â€˜when a node is
                  removedâ€™, in some edge cases the outbound XDCR mutation statistics show a negative
                  number on the monitoring page.</entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </p>
      <p><b>Fixed Issues</b></p>
      <p><b>Data Service</b></p>
      <p>
        <table frame="all" rowsep="1" colsep="1" id="table_tbm_p3s_dz">
          <tgroup cols="2">
            <colspec colname="c1" colnum="1" colwidth="1*"/>
            <colspec colname="c2" colnum="2" colwidth="2.64*"/>
            <thead>
              <row>
                <entry>Issue</entry>
                <entry>Description</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-21762" format="html"
                    scope="external">MB-21762</xref></entry>
                <entry>Sub-document commands failed when Couchbase Server was under memory
                  pressure.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-20868" format="html"
                    scope="external">MB-20868</xref></entry>
                <entry>The Data Service would crash when an invalid cluster map was prepared for a
                  Memcached bucket.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-21597" format="html"
                    scope="external">MB-21597</xref></entry>
                <entry>In the case of concurrent sub-document API operations from multiple clients,
                  Couchbase Server does not honor the atomicity. This can result in one update
                  overwriting the previous update, even though the previous update was successful as
                  far as the client is concerned.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-21448" format="html"
                    scope="external">MB-21448</xref></entry>
                <entry>Performing the <codeph>REPLACE_WITH_CAS</codeph> operation on a key which has
                  recently been deleted and then requested can occasionally return
                    <codeph>KEY_EEXISTS</codeph> (key exists but with different CAS) instead of the
                  expected <codeph>KEY_ENOENT</codeph>.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-20519" format="html"
                    scope="external">MB-20519</xref></entry>
                <entry>Memory allocation in Data Service caused Memcached to continuously crash on
                  Microsoft Windows 10 Anniversary Edition.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-20245" format="html"
                    scope="external">MB-20245</xref></entry>
                <entry>When using the access.log, the Data Service warmup would not honour the
                  thresholds to stop. It would only stop once all the documents in the access.log
                  was loaded.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-21475" format="html"
                    scope="external">MB-21475</xref></entry>
                <entry>There is a race condition where the Data service node crashes and when a
                  bucket is deleted.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-20822" format="html"
                    scope="external">MB-20822</xref></entry>
                <entry>The Failover table showed some entries that resulted in the incorrect vbucket
                  sequence numbers.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-20623" format="html"
                    scope="external">MB-20623</xref></entry>
                <entry>When the Data service node performs warmup using the access.log, it can use a
                  lot of memory causing a low resident ratio.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-21511" format="html"
                    scope="external">MB-21511</xref></entry>
                <entry>Better logging message when a network connection is closed during a
                  rebalance.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-21369" format="html"
                    scope="external">MB-21369</xref></entry>
                <entry>A large number of XDCR connections to Memcached that led to connection
                  leak.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-20871" format="html"
                    scope="external">MB-20871</xref></entry>
                <entry>Fixed an issue to correctly display counters with zero values.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-20843" format="html"
                    scope="external">MB-20843</xref></entry>
                <entry>Fixed an issue when cluster's name using the REST endpoints was not
                  retrievable. </entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-19614" format="html"
                    scope="external">MB-19614</xref></entry>
                <entry>There is a race condition that can cause the XDCR service to crash when
                  replication using version 1 of XDCR. Please note that version 1 is used when
                  replicating to ElasticSearch.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-21879" format="html"
                    scope="external">MB-21879</xref></entry>
                <entry>XDCR replication might get struck and not able to replicate mutations to
                  target cluster in some cases, because the data service node is under heavy
                  load.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-21924" format="html"
                    scope="external">MB-21924</xref></entry>
                <entry>The <codeph>cbbackupmgr</codeph> incorrectly restored delete document
                  tombstones (metadata) as full documents.</entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </p>
      <p><b>Query Service</b></p>
      <p>
        <table frame="all" rowsep="1" colsep="1" id="table_ubm_p3s_dz">
          <tgroup cols="2">
            <colspec colname="c1" colnum="1" colwidth="1*"/>
            <colspec colname="c2" colnum="2" colwidth="2.64*"/>
            <thead>
              <row>
                <entry>Issue</entry>
                <entry>Description</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-21593" format="html"
                    scope="external">MB-21593</xref></entry>
                <entry>When you canceled a query from the workbench, the query continued to run on
                  the server even though the UI indicated that it was canceled.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-16772" format="html"
                    scope="external">MB-16772</xref></entry>
                <entry>Queries using indexes created on metadata attributes other than
                    <codeph>meta().id</codeph> (such as <codeph>meta().cas</codeph>,
                    <codeph>meta().expiry</codeph>) did not produce correct results.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-16857" format="html"
                    scope="external">MB-16857</xref></entry>
                <entry>The NEST ON KEYS query results may not preserve original key order of
                  fields.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-17674" format="html"
                    scope="external">MB-17674</xref></entry>
                <entry>Syntax error messages may have Unicode values instead of the character
                  itself. This is same as MB-18722 below.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-18722" format="html"
                    scope="external">MB-18722</xref></entry>
                <entry>When copied and pasted, the <codeph>PREPARE</codeph> statement text or
                  condition does not evaluate the special characters because the text contains
                  Unicode values.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-19230" format="html"
                    scope="external">MB-19230</xref></entry>
                <entry>The N1QL queries with <codeph>LIKE</codeph> predicates did not work with
                  strings containing new lines.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-19988" format="html"
                    scope="external">MB-19988</xref></entry>
                <entry>The <codeph>IN</codeph> and <codeph>WITHIN</codeph> operators may not handle
                  NULL in-list values.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-20023" format="html"
                    scope="external">MB-20023</xref></entry>
                <entry>Query engine panics with error when <codeph>WITH</codeph> clause is used with
                    <codeph>CREATE INDEX .. USING VIEWS</codeph> clause.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-20086" format="html"
                    scope="external">MB-20086</xref></entry>
                <entry>A query with <codeph>USE INDEX()</codeph> may panic when no matching
                  secondary or primary indexes are available.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-20183" format="html"
                    scope="external">MB-20183</xref></entry>
                <entry>The query text in the <codeph>EXPLAIN</codeph> plan was arbitrarily
                  truncated.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-20384" format="html"
                    scope="external">MB-20384</xref></entry>
                <entry>The Query engine displayed errors when backslash (\) was used in the
                    <codeph>LIKE</codeph> expression.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-20485" format="html"
                    scope="external">MB-20485</xref></entry>
                <entry>The <codeph>DATE_DIFF_MILLIS</codeph> displayed incorrect results in case of
                  very small difference.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-20520" format="html"
                    scope="external">MB-20520</xref></entry>
                <entry>The colon (:) was not properly encoded when setting the Predefined Session
                  Parameters in the cbq shell.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-20577" format="html"
                    scope="external">MB-20577</xref></entry>
                <entry>The cbq shell displayed password in the console error messages.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-20826" format="html"
                    scope="external">MB-20826</xref></entry>
                <entry>In the cbq shell, running multiple queries separated by semicolon (;)
                  displayed an error in the batch mode.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-20897" format="html"
                    scope="external">MB-20897</xref></entry>
                <entry>In the cbq shell, the \SET command without name and only prefix, resulted in
                  an empty parameter with a value.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-20925" format="html"
                    scope="external">MB-20925</xref></entry>
                <entry>N1QL queries with correlated sub-query using covered index did not return
                  results.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-21161" format="html"
                    scope="external">MB-21161</xref></entry>
                <entry>The cbq command line utility was not working properly when the [User/Bucket]
                  password contained special characters.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-21384" format="html"
                    scope="external">MB-21384</xref></entry>
                <entry>Queries accessing system keyspace got access to all buckets, even though one
                  of the buckets in the query was password protected.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-21660" format="html"
                    scope="external">MB-21660</xref></entry>
                <entry>A query with chained <codeph>UPDATE FOR</codeph> clause does not work for
                  nested array element fields.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-21720" format="html"
                    scope="external">MB-21720</xref></entry>
                <entry>Composite predicate with AND of ANY / EVERY expressions do not work with
                  array indexes.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-21816" format="html"
                    scope="external">MB-21816</xref></entry>
                <entry>The <codeph>MILLIS_TO_STR()</codeph> and <codeph>STR_TO_MILLIS()</codeph>
                  functions converted incorrectly for the futuristic date/time values.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-21958" format="html"
                    scope="external">MB-21958</xref></entry>
                <entry>Incorrect result when the <codeph>SELECT COUNT()</codeph> query uses a
                  secondary index for the query, and has <codeph>META().id</codeph> in the
                  predicate.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-22000" format="html"
                    scope="external">MB-22000</xref></entry>
                <entry>N1QL query returned intermittent error "Index not found" even though index
                  was present. </entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-22093" format="html"
                    scope="external">MB-22093</xref></entry>
                <entry>N1QL queries returned "Error performing bulk get operation" errors
                  intermittently.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-22105" format="html"
                    scope="external">MB-22105</xref></entry>
                <entry>The <codeph>UPDATE</codeph>, <codeph>INSERT</codeph>, <codeph>UPSERT</codeph>
                  statements may fail with the error message: "Panic: : runtime error: slice bounds
                  out of range", when running with increased pipeline_batch settings.</entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </p>
      <p><b>Index Service</b></p>
      <p>
        <table frame="all" rowsep="1" colsep="1" id="table_vbm_p3s_dz">
          <tgroup cols="2">
            <colspec colname="c1" colnum="1" colwidth="1*"/>
            <colspec colname="c2" colnum="2" colwidth="2.64*"/>
            <thead>
              <row>
                <entry>Issue</entry>
                <entry>Description</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-21038" format="html"
                    scope="external">MB-21038</xref></entry>
                <entry>Upgrading nodes with the query service to version 4.5 causes version 4.0
                  indexer services to crash during rolling upgrade
                  (<codeph>stale=false</codeph>).</entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </p>
      <p><b>FTS Service</b></p>
      <p>
        <table frame="all" rowsep="1" colsep="1" id="table_wbm_p3s_dz">
          <tgroup cols="2">
            <colspec colname="c1" colnum="1" colwidth="1*"/>
            <colspec colname="c2" colnum="2" colwidth="2.64*"/>
            <thead>
              <row>
                <entry>Issue</entry>
                <entry>Description</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-18042" format="html"
                    scope="external">MB-18042</xref></entry>
                <entry>Breaking Change. FTS index definitions from earlier releases no longer work
                  due to the removal of byte_array_converter. Workaround: Manually remove the
                  "byte_array_converter" attribute from the index definition JSON and then recreate
                  the index.</entry>
              </row>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-21595" format="html"
                    scope="external">MB-21595</xref></entry>
                <entry>MossStore is now the default kv store for FTS. If you have full text index
                  definitions from previous versions that you want to update, change "kvStoreName"
                  to "mossStore", otherwise they will stay set to "forestdb".</entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </p>
      <p><b>Security</b></p>
      <p>
        <table frame="all" rowsep="1" colsep="1" id="table_xbm_p3s_dz">
          <tgroup cols="2">
            <colspec colname="c1" colnum="1" colwidth="1*"/>
            <colspec colname="c2" colnum="2" colwidth="2.64*"/>
            <thead>
              <row>
                <entry>Issue</entry>
                <entry>Description</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry><xref href="https://issues.couchbase.com/browse/MB-21814" format="html"
                    scope="external">MB-21814</xref></entry>
                <entry>The Email Server Password was not saved correctly when the Email Alerts
                  setting was enabled (from the <uicontrol>Settings</uicontrol> >
                    <uicontrol>Alerts</uicontrol> page).</entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </p>
    </section>
    <p><b>Deprecated Items</b></p>
    <p>Support for the following platforms is deprecated in this release: <ul id="ul_tkf_vml_wx">
        <li>Microsoft Windows 2008</li>
        <li>Microsoft Windows 2008 R2 SP1</li>
        <li>Ubuntu 12.0.4</li>
        <li>Mac OS X 10.10</li>
      </ul></p>
    <p>
      <note>For Windows, .exe installers are deprecated starting with 4.6.0. Beginning with the next
        major release, Windows installers will be delivered as industry-standard MSI files.
        Furthermore, in-place upgrade of a node from 4.x to 5.x will not be supported. When
        upgrading a cluster to 5.x, we recommend performing a <xref
          href="https://www.couchbase.com/blog/Couchbase-rolling-upgrades" format="html"
          scope="external">rolling-upgrade</xref>.</note>
    </p>
    <p>The following platforms are no longer supported: </p>
    <p>
      <ul id="ul_arx_kgx_4y">
        <li>Microsoft Windows 8</li>
        <li>Mac OS X 10.9</li>
        <li>Amazon Linux 2014.03</li>
      </ul>
    </p>
    <p>The following functionality is deprecated, will be deprecated or is unsupported.</p>
    <p>
      <table frame="all" rowsep="1" colsep="1" id="table_bl3_533_1v">
        <tgroup cols="2">
          <colspec colname="c1" colnum="1" colwidth="1*"/>
          <colspec colname="c2" colnum="2" colwidth="3*"/>
          <thead>
            <row>
              <entry>Function</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>TAP</entry>
              <entry>The TAP is an internal protocol that streams information about data changes
                between cluster nodes. In future releases, this protocol will be removed and not
                supported. The TAP is replaced with the Database Change Protocol (<xref
                  href="../architecture/high-availability-replication-architecture.dita#concept_hj1_njj_vs"
                  >DCP</xref>). </entry>
            </row>
            <row>
              <entry>CLI <codeph>setting-ldap</codeph> command</entry>
              <entry>This command is deprecated in this release. Use the
                  <codeph>admin-role-manage</codeph> command instead.</entry>
            </row>
            <row>
              <entry>CLI <codeph>group-manage</codeph> command</entry>
              <entry>Adding servers using the <codeph>group-manage</codeph> command is deprecated in
                this release. To add a server, use the <codeph>server-add</codeph> CLI
                command.</entry>
            </row>
            <row>
              <entry>CLI <codeph>rebalance</codeph> command</entry>
              <entry>Adding servers using the <codeph>couchbase-cli rebalance</codeph> command is
                deprecated in this release. Use the <codeph>couchbase-server-add</codeph> CLI
                command instead.</entry>
            </row>
            <row>
              <entry>CLI <codeph>failover</codeph> command</entry>
              <entry>Failing over multiple servers using one <codeph>failover</codeph> command
                option is deprecated in this release. Run the <codeph>failover</codeph> command once
                for each server.</entry>
            </row>
            <row>
              <entry>CLI <codeph>server-readd</codeph> command</entry>
              <entry>The <codeph>server-readd</codeph> command is deprecated in this release. Use
                the <codeph>recovery</codeph> command instead.</entry>
            </row>
            <row>
              <entry><codeph>BASE64()</codeph></entry>
              <entry>The <codeph>BASE64()</codeph> function is deprecated in version 4.5; use the
                function <codeph>BASE64_ENCODE()</codeph> instead. <p>Also, use the
                    <codeph>BASE64_DECODE()</codeph> function to reverse the encoding done by
                    <codeph>BASE64_ENCODE().</codeph></p></entry>
            </row>
            <row>
              <entry>Server-side moxi <xref
                  href="http://developer.couchbase.com/documentation/server/4.0/install/install-client-server.html"
                  format="html" scope="external">proxy</xref> is deprecated in 4.5</entry>
              <entry>Use Couchbase client SDKs or client-side moxi in your applications.</entry>
            </row>
            <row>
              <entry>CRAM-MD5 for bucket authentication</entry>
              <entry>Use SCRAM protocol supporting clients for bucket authentication in Couchbase
                Server version 4.5. SCRAM protocol for bucket authentication will first be
                introduced in Java, followed by other SDK clients. </entry>
            </row>
            <row>
              <entry>Deprecate XDCR API from <filepath>/internalSettings</filepath> REST endpoint in
                4.5</entry>
              <entry><filepath>/Settings/replications</filepath> REST endpoint will be available for
                all replication settings and provides the same functionality.</entry>
            </row>
            <row>
              <entry>N1QL: Deprecated the use of path-expressions in <codeph>FROM</codeph> and
                  <codeph>JOIN</codeph> clauses in version 4.5</entry>
              <entry>FROM and JOIN clauses should use only keyspaces. Paths can be used for
                expressions in other clauses, operators, projections, and so on.<p> For example:
                  <codeblock>SELECT count(*) FROM `travel-sample`.schedule; </codeblock> can be
                  rewritten as:
                  <codeblock>SELECT count(*)  FROM `travel-sample` WHERE schedule IS NOT MISSING;</codeblock></p></entry>
            </row>
            <row>
              <entry>CAPI based XDCR </entry>
              <entry>CAPI based XDCR is deprecated and will be removed in a future version of
                Couchbase Server. <p>Note that the support for Elasticsearch Plugin has not been
                  removed. However, the Elasticsearch Plugin may be modified in the future to use an
                  alternative connection method such as DCP or XMEM XDCR (XDCR v2).</p></entry>
            </row>
            <row>
              <entry>FTS support for ForestDB as a KV Store</entry>
              <entry>As of this release, FTS indexes use MossStore as their default KV store. FTS
                support for ForestDB as a KV store will be removed in a future version of Couchbase
                Server.</entry>
            </row>
            <row>
              <entry>Couchbase Enterprise Backup and Restore tool</entry>
              <entry>The tools, <codeph>cbbackup</codeph> and <codeph>cbrestore</codeph>, are
                deprecated from the Enterprise Edition. We recommend replacing these old tools with
                the new enterprise backup and restore tool, <xref
                  href="../backup-restore/cbbackupmgr.dita">cbbackupmgr</xref>, in version
                4.5.</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
    </p>
  </body>
</topic>
